<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${titulo}">Cambiar Contraseña</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="/css/style-custom.css" rel="stylesheet" />
</head>
<body>
<div class="wrapper">
    <!-- Sidebar -->
    <div th:replace="fragments/sidebar :: sidebar"></div>

    <!-- Contenido -->
    <div class="content" id="content">
       <div class="container py-4">
    <h2 class="mb-4 text-center" th:text="${titulo}">Cambiar Contraseña</h2>

    <!-- Alertas -->
    <div th:if="${success != null}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    <div th:if="${error != null}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${error}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Formulario de Cambio de Contraseña -->
    <form th:action="@{/usuarios/lista/cambiar-contrasena/{id}(id=${usuario.id})}"
          th:object="${usuario}" method="post" class="mx-auto w-50 row g-3 needs-validation" novalidate>

        <!-- Contraseña Actual -->
        <div class="col-12 position-relative">
            <label class="form-label">Contraseña Actual:</label>
            <div class="input-group">
                <input type="password" th:field="*{contrasenaActual}" class="form-control"
                       th:classappend="${#fields.hasErrors('contrasenaActual')} ? ' is-invalid' : ''" required>
                <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('contrasenaActual')">
                    <i class="bi bi-eye"></i>
                </button>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('contrasenaActual')}" th:errors="*{contrasenaActual}"></div>
            </div>
        </div>

        <!-- Nueva Contraseña -->
        <div class="col-12 position-relative">
            <label class="form-label">Nueva Contraseña:</label>
            <div class="input-group">
                <input type="password" th:field="*{nuevaContrasena}" class="form-control"
                       th:classappend="${#fields.hasErrors('nuevaContrasena')} ? ' is-invalid' : ''" required>
                <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('nuevaContrasena')">
                    <i class="bi bi-eye"></i>
                </button>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('nuevaContrasena')}" th:errors="*{nuevaContrasena}"></div>
            </div>
        </div>

        <!-- Confirmar Contraseña -->
        <div class="col-12 position-relative">
            <label class="form-label">Confirmar Nueva Contraseña:</label>
            <div class="input-group">
                <input type="password" th:field="*{confirmarContrasena}" class="form-control"
                       th:classappend="${#fields.hasErrors('confirmarContrasena')} ? ' is-invalid' : ''" required>
                <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('confirmarContrasena')">
                    <i class="bi bi-eye"></i>
                </button>
                <div class="invalid-feedback" th:if="${#fields.hasErrors('confirmarContrasena')}" th:errors="*{confirmarContrasena}"></div>
            </div>
        </div>

        <!-- Botones -->
<div class="col-12 d-flex justify-content-center gap-3 mt-3">
    <button type="submit" class="btn btn-primary py-1" style="width: 120px;">Guardar</button>
    <a th:href="@{/usuarios/lista}" 
       class="btn btn-secondary py-1 d-flex justify-content-center align-items-center" 
       style="width: 120px;">Cancelar</a>
</div>
    </form>
</div>

    </div>
</div>

<!-- Scripts -->
<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('collapsed');
    }

    function togglePassword(fieldName) {
        const field = document.querySelector('[name="' + fieldName + '"]');
        field.type = field.type === "password" ? "text" : "password";
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
