<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Actualizar Saludo y Firma</title>

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
	rel="stylesheet" />
<link href="/css/style-custom.css" rel="stylesheet" />
</head>

<body>
	<div class="wrapper">
		<!-- Sidebar -->
		<div th:replace="fragments/sidebar :: sidebar"></div>

		<!-- Contenido -->
		<div class="content" id="content">
			<div class="container py-4">

				<h2 class="mb-4 text-center">Editar Saludo y Firma</h2>

				<!-- Alertas -->
				<div th:if="${success != null}"
					class="alert alert-success alert-dismissible fade show"
					role="alert">
					<span th:text="${success}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert"
						aria-label="Close"></button>
				</div>

				<div th:if="${error != null}"
					class="alert alert-danger alert-dismissible fade show" role="alert">
					<span th:text="${error}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert"
						aria-label="Close"></button>
				</div>

				<!-- Formulario -->
				<form
					th:action="@{'/usuarios/lista/cambiar-saludo-firma/' + ${usuario.id}}"
					th:object="${usuario}" method="post"
					class="mx-auto w-50 row g-3 needs-validation" novalidate>

					<input type="hidden" th:field="*{id}" />

					<div class="col-12 position-relative">
						<label class="form-label">Saludo:</label>

						<textarea id="saludo" th:field="*{saludo}" class="form-control" rows="3"
							placeholder="Ej: Hola, buen día."
							maxlength="200" required></textarea>
						<div class="d-flex justify-content-between">
						    <small class="text-secondary">
						        Este campo se utilizará como saludo predeterminado al responder consultas y enviar correos.
						    </small>
						    <small id="saludoCounter" class="text-secondary">
							    <span id="saludoCount">0</span>/200
							</small>
						</div>
					</div>

					<!-- Firma -->
					<div class="col-12 position-relative">
						<label class="form-label">Firma:</label>

						<textarea id="firma" th:field="*{firma}" class="form-control" rows="4"
							placeholder="Ej:&#10;Juan Pérez&#10;Soporte Técnico" 
							maxlength="200" required></textarea>
						<div class="d-flex justify-content-between">
						    <small class="text-secondary">
						        Este texto será tu firma por defecto al cerrar un mensaje o correo generado desde el sistema.
						    </small>
						    <small id="firmaCounter" class="text-secondary">
							    <span id="firmaCount">0</span>/200
							</small>
						</div>
					</div>

					<!-- Botones -->
					<div class="col-12 d-flex justify-content-center gap-3 mt-3">
						<button type="submit" class="btn btn-primary py-1"
							style="width: 120px;">Guardar</button>

						<a th:href="@{/usuarios/lista}"
							class="btn btn-secondary py-1 d-flex justify-content-center align-items-center"
							style="width: 120px;">Cancelar</a>
					</div>

				</form>

			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script>
    const sidebar = document.getElementById("sidebar");

    // Estado inicial: si no existe el estado, se guarda "collapsed"
    if (!localStorage.getItem("sidebarState")) {
        localStorage.setItem("sidebarState", "collapsed");
    }

    // Aplicar estado guardado
    if (localStorage.getItem("sidebarState") === "collapsed") {
        sidebar.classList.add("collapsed");
    } else {
        sidebar.classList.remove("collapsed");
    }

    // Función para botón hamburguesa
    function toggleSidebar() {
        sidebar.classList.toggle("collapsed");

        if (sidebar.classList.contains("collapsed")) {
            localStorage.setItem("sidebarState", "collapsed");
        } else {
            localStorage.setItem("sidebarState", "open");
        }
    }
    
    // Función Para Contador Limite Caracteres
    function setupCounter(textareaId, countId, counterWrapperId, max) {
	    const textarea = document.getElementById(textareaId);
	    const count = document.getElementById(countId);
	    const wrapper = document.getElementById(counterWrapperId);
	
	    function updateCount() {
	        const length = textarea.value.length;
	        count.textContent = length;
	
	        if (length >= max) {
	            wrapper.classList.remove("text-secondary");
	            wrapper.classList.add("text-danger");
	        } else {
	            wrapper.classList.remove("text-danger");
	            wrapper.classList.add("text-secondary");
	        }
	    }
	
	    textarea.addEventListener("input", updateCount);
	    updateCount();
	}
	
	setupCounter("saludo", "saludoCount", "saludoCounter", 200);
	setupCounter("firma", "firmaCount", "firmaCounter", 200);
</script>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
